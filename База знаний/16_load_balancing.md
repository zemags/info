# Балансировка нагрузки (Load Balancing)

- Растет нагрузка  
- Сервера объединяем в кластер  
- Нагрузку распределяем между ними с помощью балансировщика

---

## Виды балансировки нагрузки

### Балансировка на сетевом уровне (L3/L4)
- Один IP-адрес на несколько физических машин (простое перенаправление трафика)
- Балансировка с помощью DNS (алгоритм round robin)
    - Может использоваться для геораспределения (например, разные территории)
- Примеры: IPVS, LVS, DNS round robin

### Балансировка на транспортном уровне (L4)
- Перенаправление клиентского запроса от балансировщика к одному из серверов
- Выбор сервера либо по кругу, либо наименее загруженному
- Балансировщик может добавлять информацию о клиенте в дополнительные данные и заголовки (например, X-Forwarded-For)
- Примеры: HAProxy, Nginx (TCP), AWS ELB

### Балансировка на прикладном уровне (L7)
- Балансировка и перенаправление в зависимости от содержимого запроса (например, URL, cookies, хедеры)
- Позволяет реализовать умную маршрутизацию (например, разные сервисы в зависимости от пути)
- Примеры: Nginx, Traefik, Envoy, HAProxy (HTTP/HTTPS)

---

## Алгоритмы балансировки нагрузки

### Round Robin
- Перебор серверов по кругу
- Недостаток: не учитывает текущую загрузку сервера — запрос может попасть на уже перегруженный сервер

### Weighted Round Robin
- У каждого сервера свой вес в зависимости от его мощности
- Сервер с большим весом получает больше запросов

### Least Connections
- Запрос отправляется на сервер с наименьшим количеством активных подключений

### Weighted Least Connections
- Учитывает вес сервера и количество подключений

### IP Hash
- Сервер выбирается на основе хеша IP-адреса клиента
- Позволяет сохранять "стики" (sticky sessions)

### Random
- Сервер выбирается случайным образом из пула

---

## Дополнительно

- Sticky sessions: привязка пользователя к конкретному серверу (например, по cookie или IP)
- Health checks: балансировщик регулярно проверяет состояние серверов и исключает "упавшие" из пула
- SSL termination: балансировщик может принимать HTTPS-трафик и передавать его дальше как HTTP
